<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>4 Gewinnt</title>
    <style type="text/css">
        #gamecontainer {
            font-size: 1.25em;
            width: 60vw;
            margin: 40vh auto 0 auto;
        }

        table {
            margin: 0 auto;
            border-collapse: collapse;
        }

        td {
            border: 5px solid dodgerblue;
            width: 50px;
            height: 50px;
            text-align: center;
        }

        .kreis {
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

    </style>
</head>
<body>
<div id="gamecontainer">
</div>

<script>
    var totalRows = 6;
    var cellsInRow = 6;
    var spFarbe = "green";
    var aiFarbe = "blue";
    var container = document.getElementById('gamecontainer');
    var anzZuege = 0;
    var gameOver = false;

    function start() {
        var buttonY = document.createElement("button");
        var buttonR = document.createElement("button");
        buttonY.setAttribute("onClick", "farbAuswahl('yellow')");
        buttonR.setAttribute("onClick", "farbAuswahl('red')");
        buttonY.innerHTML = "Gelb";
        buttonR.innerHTML = "Rot";
        container.append(buttonY);
        container.append(buttonR);
    }

    function farbAuswahl(farbe) {
        spFarbe = farbe;
        if (farbe === "yellow") {
            aiFarbe = "red";
        } else {
            aiFarbe = "yellow";
        }
        console.log(farbe + " ai:" + aiFarbe);
        drawTable();
    }

    function drawTable() {
        var div1 = document.getElementById('gamecontainer');
        var tbl = document.createElement("table");

        for (var r = 0; r < totalRows; r++) {
            var row = document.createElement("tr");

            for (var c = 0; c < cellsInRow; c++) {
                var cell = document.createElement("td");
                cellid = r + '' + c;
                cell.setAttribute('row', r);
                cell.setAttribute('col', c);
                cell.id = cellid;
                cell.onclick = function () {
                    if (!gameOver) {
                        drawClick(this.id);
                    }
                };
                row.appendChild(cell);
            }
            tbl.appendChild(row);
        }
        div1.appendChild(tbl);
    }


    function drawClick(feld) {
        let clickFeld = document.getElementById(feld);
        let col = clickFeld.getAttribute("col");
        let row = clickFeld.getAttribute("row");
        console.log(row + " " + col);
        drawCircle(col, row, spFarbe);

        var millisecondsToWait = 500;
        setTimeout(function () {
            aiZug();
        }, millisecondsToWait);
    }

    function aiZug() {
        drawCircle(randomInt(cellsInRow), randomInt(totalRows), aiFarbe);

    }

    function randomInt(max) {
        return Math.floor(Math.random() * Math.floor(max));
    }

    function drawCircle(col, row, color) {
        let firstField = document.querySelector('[col="' + col + '"][row="' + 0 + '"]');
        if (!firstField.hasAttribute("color")) {
            for (let iFeld = totalRows - 1; iFeld >= 0; iFeld--) {
                if (!document.querySelector('[col="' + col + '"][row="' + iFeld + '"]').hasAttribute("color")) {
                    let circle = document.createElement('div');
                    circle.className = "kreis";
                    circle.style.backgroundColor = color;
                    document.querySelector('[col="' + col + '"][row="' + iFeld + '"]').appendChild(circle);
                    document.querySelector('[col="' + col + '"][row="' + iFeld + '"]').setAttribute("color", color);
                    anzZuege++;
                    if (anzZuege >= 7) {
                        checkIfWon(parseInt(col), iFeld, color);
                    }
                    break;
                }
            }
        }
    }

    function checkIfWon(col, row, color) {
        if (row <= (totalRows - 4)) {
            checkSenkrecht(col, row, color);
            if (col <= (cellsInRow - 4))
                checkDiagonal(col, row, color, true);
            if (col >= 4)
                checkDiagonal(col, row, color, false);
        }
    }

    function checkSenkrecht(col, row, color) {
        for (let i = 1; i < 4; i++) {
            let newRow = (row + i);
            if (document.querySelector('[col="' + col + '"][row="' + newRow + '"]').getAttribute("color") !== color) {
                i = 1;
                break;
            } else {
                if (i === 3) {
                    alert("win " + color);
                    gameOver = true;
                    break;
                }

            }
        }
    }

    function checkDiagonal(col, row, color, diagonalRechts) {
        if (diagonalRechts) {
            for (let i = 1; i < 4; i++) {
                let newRow = (row + i);
                let newCol = (parseInt(col) + i);
                console.log("new col: " + newCol + " - new Row: " + newRow);
                if (document.querySelector('[col="' + newCol + '"][row="' + newRow + '"]').getAttribute("color") !== color) {
                    console.log("break 1: " + document.querySelector('[col="' + newCol + '"][row="' + newRow + '"]').getAttribute("color") + "color= " + color);
                    i = 1;
                    break;
                } else {
                    if (i === 3) {
                        alert("win diagonal " + diagonalRechts + " " + color);
                        gameOver = true;
                        break;
                    }

                }
            }
        } else {
            for (let i = 1; i < 4; i++) {
                let newRow = (row + i);
                let newCol = (col - i);
                console.log("new col: " + newCol + " - new Row: " + newRow);
                if (document.querySelector('[col="' + newCol + '"][row="' + newRow + '"]').getAttribute("color") !== color) {
                    console.log("break 1: " + document.querySelector('[col="' + newCol + '"][row="' + newRow + '"]').getAttribute("color") + "color= " + color);
                    i = 1;
                    break;
                } else {
                    if (i === 3) {
                        alert("win diagonal " + diagonalRechts + " " + color);
                        gameOver = true;
                        break;
                    }

                }
            }
        }
    }


    window.onload = start;
</script>

</body>
</html>